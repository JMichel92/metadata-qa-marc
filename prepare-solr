#!/usr/bin/env bash

CORE=$1
PORT=8983

URL=$(printf "http://localhost:%s/solr/admin/cores?action=STATUS&core=%s" $PORT $CORE)
CORE_NOT_EXISTS=$(curl -s "$URL" | jq .status | grep "$SOLR_CORE" | grep -c '{}')
if [[ "$CORE_NOT_EXISTS" != "0" ]]; then
  # create core
  echo "Create Solr core '$SOLR_CORE'"
  curl -s "http://localhost:$PORT/solr/admin/cores?action=CREATE&name=$SOLR_CORE&configSet=_default"
fi

echo DONE

# add *_sni
# <dynamicField name="*_sni" type="string" indexed="false" stored="true"/>
curl -X POST -H 'Content-type:application/json' --data-binary '{
  "add-dynamic-field":{
     "name":"*_sni",
     "type":"string",
     "stored":true,
     "indexed":false
  }
}' http://localhost:${PORT}/api/cores/${CORE}/schema

# add _ss
# <copyField source="*_ss" dest="_text_"/>
curl -X POST -H 'Content-type:application/json' --data-binary '{
  "add-copy-field":{
     "source":"*_ss",
     "dest":"_text_"
  }
}' http://localhost:${PORT}/api/cores/${CORE}/schema
